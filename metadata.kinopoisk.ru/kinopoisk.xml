<?xml version="1.0" encoding="UTF-8"?>
<scraper date="2010-02-23" framework="1.1">
	<!-- Формируем поисковый URl -->
	<CreateSearchUrl SearchStringEncoding="CP1251" dest="3">
		<RegExp input="$$1" output="&lt;url&gt;http://www.kinopoisk.ru/index.php?level=7&amp;from=forma&amp;result=adv&amp;m_act%5Bfrom%5D=forma&amp;m_act%5Bwhat%5D=content&amp;m_act%5Bfind%5D=\1&amp;m_act%5Byear%5D=$$2|User-Agent=Mozilla%2F5.0%20(X11%3B%20U%3B%20Linux%20i686%3B%20en-US%3B%20rv%3A1.8.1.14)%20Gecko%2F20080418%20Ubuntu%2F7.10%20(gutsy)%20Firefox%2F2.0.0.14&lt;/url&gt;" dest="3">
			<expression noclean="1"/>
		</RegExp>
	</CreateSearchUrl>
	<!-- Выбираем найденные совпадения -->
	<GetSearchResults dest="8">
		<RegExp input="$$5" output="&lt;?xml version=&quot;1.0&quot; encoding=&quot;windows-1251&quot; standalone=&quot;yes&quot;?&gt;&lt;results sorted=&quot;yes&quot;&gt;\1&lt;/results&gt;" dest="8">
			<!--Код если найден единственный вариант-->
			<RegExp input="$$7" output="&lt;entity&gt;\1&lt;/entity&gt;" dest="5+">
				<RegExp input="$$1" output="&lt;title&gt;\1 " dest="7">
					<expression trim="1">&lt;title&gt;([^&lt;]+)&lt;/title&gt;</expression>
				</RegExp>
				<RegExp input="$$1" output="(\1)&lt;/title&gt;" dest="7+">
					<expression>&lt;td class=""&gt;&lt;a href="/level/10/m_act%5Byear%5D/\d+/"&gt;(\d+)&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;</expression>
				</RegExp>
				<RegExp input="$$1" output="&lt;url&gt;http://www.kinopoisk.ru/level/1/film/\1|User-Agent=Mozilla%2F5.0%20(X11%3B%20U%3B%20Linux%20i686%3B%20en-US%3B%20rv%3A1.8.1.14)%20Gecko%2F20080418%20Ubuntu%2F7.10%20(gutsy)%20Firefox%2F2.0.0.14&lt;/url&gt;" dest="7+">
					<expression>&lt;a href=&quot;/level/19/film/(\d+)/&quot;&gt;</expression>
				</RegExp>
				<expression noclean="1" />
			</RegExp>
			<!--Код если найдено несколько вариантов-->
			<RegExp input="$$1" output="&lt;entity&gt;&lt;title&gt;\2 (\3)&lt;/title&gt;&lt;url&gt;http://www.kinopoisk.ru/level\1|User-Agent=Mozilla%2F5.0%20(X11%3B%20U%3B%20Linux%20i686%3B%20en-US%3B%20rv%3A1.8.1.14)%20Gecko%2F20080418%20Ubuntu%2F7.10%20(gutsy)%20Firefox%2F2.0.0.14&lt;/url&gt;&lt;/entity&gt;" dest="5+">
				<expression repeat="yes">&lt;a class="all" href="/level([^"]*)"&gt;([^&lt;]*)&lt;/a&gt;,&amp;nbsp;&lt;a[^&gt;]*&gt;([^&lt;]*)&lt;</expression>
			</RegExp>
			<expression noclean="1" />
		</RegExp>
	</GetSearchResults>
	<GetDetails clearbuffers="no" dest="3">
		<RegExp input="$$5" output="&lt;details&gt;\1&lt;/details&gt;" dest="3">
			<!--TITLE-->
			<RegExp input="$$1" output="&lt;title&gt;\1&lt;/title&gt;" dest="5">
				<expression trim="1">&lt;title&gt;([^&lt;]+)&lt;/title&gt;</expression>
			</RegExp>
			<!--ORIGINALTITLE-->
			<RegExp input="$$1" output="&lt;originaltitle&gt;\1&lt;/originaltitle&gt;" dest="5+">
				<expression>&lt;span style=&quot;color: #666; font-size: 13px&quot;&gt;([^&lt;]+)&lt;/span&gt;</expression>
			</RegExp>
			<!--COUNTRY-->
			<RegExp input="$$1" output="&lt;country&gt;\2&lt;/country&gt;" dest="5+">
				<expression repeat="yes">&lt;a href=&quot;/level/10/m_act%5Bcountry%5D/.+?/&quot;&gt;&lt;img src=&quot;/images/flags/flag(.*?)alt=&quot;(.*?)&quot;</expression>
			</RegExp>
			<!--YEAR-->
			<RegExp input="$$1" output="&lt;year&gt;\1&lt;/year&gt;" dest="5+">
				<expression>&lt;td class=&quot;&quot;&gt;&lt;a href=&quot;/level/10/m_act%5Byear%5D/\d+/&quot;&gt;(\d+)&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;</expression>
			</RegExp>
			<!--TOP250-->
			<RegExp input="$$1" output="&lt;top250&gt;\1&lt;/top250&gt;" dest="5+">
				<expression>Top250: &lt;a[^&gt;]+&gt;([0-9]*)&lt;/a&gt;</expression>
			</RegExp>
			<!--Рейтинг MPAA-->
			<RegExp input="$$1" output="&lt;mpaa&gt;\1&lt;/mpaa&gt;" dest="5+">
				<expression>&lt;tr&gt;&lt;td class=&quot;type&quot;&gt;[^&lt;]+MPAA&lt;/td&gt;&lt;td[^&gt;]+&gt;&lt;a href=&apos;.+?/rn/(.+?)/&apos;</expression>
			</RegExp>
			<!--TAGLINE-->
			<RegExp input="$$1" output="&lt;tagline&gt;\1&lt;/tagline&gt;" dest="5+">
				<expression>&lt;td style=&quot;color: #555&quot;&gt;&amp;laquo;(.+?)&amp;raquo;&lt;/td&gt;&lt;/tr&gt;</expression>
			</RegExp>
			<!--RUNTIME-->
			<RegExp input="$$1" output="&lt;runtime&gt;\1&lt;/runtime&gt;" dest="5+">
				<expression>&lt;td class=&quot;time&quot; id=&quot;runtime&quot;&gt;([0-9]+)</expression>
			</RegExp>
			<!--Рейтинг IMDB-->
			<RegExp input="$$1" output="&lt;rating&gt;\1&lt;/rating&gt;&lt;votes&gt;\2&lt;/votes&gt;" dest="5+">
				<expression>IMDB: ([0-9.]+) \(([0-9\s]+)\)&lt;/div&gt;</expression>
			</RegExp>
			<!--GENRE-->
			<RegExp input="$$1" output="&lt;genre&gt;\1&lt;/genre&gt;" dest="5+">
				<expression repeat="yes">&lt;a href=&quot;/level/10/m_act%5Bgenre%5D/\d+/&quot;&gt;([^&gt;]*)&lt;/a&gt;</expression>
			</RegExp>
			<!--STUDIO-->
			<RegExp input="$$1" output="&lt;studio&gt;\1&lt;/studio&gt;" dest="5+">
				<expression>&lt;a href=&apos;/level/10/m_act\[company\]/\d+/&apos; class=&apos;all&apos;&gt;&amp;laquo;(.+?)&amp;raquo;&lt;/a&gt;</expression>
			</RegExp>
			<RegExp input="$$1" output="&lt;url function=&quot;PEOPLE&quot;&gt;http://www.kinopoisk.ru/level/19/film/\1&lt;/url&gt;" dest="5+">
				<expression>href=&quot;/level/19/film/(\d+)/&quot;</expression>
			</RegExp>
			<!--PLOT and OUTLINE-->
			<RegExp input="$$1" output="\1&amp;#133;&amp;laquo;&amp;#151;&amp;mdash;&amp;nbsp;&lt;=end=&gt;" dest="2">
				<expression noclean="1">&lt;tr&gt;&lt;td colspan=3 style=&quot;padding: 10px 10px 20px 20px&quot; class=&quot;news&quot;&gt;\s+&lt;span class=&quot;_reachbanner_&quot;&gt;[\t\n]*(.*?)[\t\n]*&lt;/span&gt;</expression>
			</RegExp>
			<RegExp input="$$4" output="&lt;outline&gt;\1&lt;/outline&gt;&lt;plot&gt;\1&lt;/plot&gt;" dest="5+">
				<RegExp input="$$2" output="\1 " dest="4">
					<expression repeat="yes" noclean="1">(.*?)(?:&lt;br /&gt;\r\n|&lt;br&gt;|&lt;=end=&gt;)</expression>
				</RegExp>
				<RegExp input="$$4" output="\1 " dest="4">
					<expression repeat="yes" noclean="1">(.*?)&amp;nbsp;</expression>
				</RegExp>
				<RegExp input="$$4" output="\1--" dest="4">
					<expression repeat="yes" noclean="1">(.*?)&amp;mdash;</expression>
				</RegExp>
				<RegExp input="$$4" output="\1-" dest="4">
					<expression repeat="yes" noclean="1">(.*?)&amp;#151;</expression>
				</RegExp>
				<RegExp input="$$4" output="\1&quot;" dest="4">
					<expression repeat="yes" noclean="1">(.*?)&amp;[lr]aquo;</expression>
				</RegExp>
				<RegExp input="$$4" output="\1..." dest="4">
					<expression repeat="yes" noclean="1">(.*?)(?:&amp;#133;|&amp;hellip;)</expression>
				</RegExp>
				<expression trim="1">(.*)\.\.\.</expression>
			</RegExp>
			<RegExp input="$$1" output="&lt;url function=&quot;GMP&quot;&gt;http://www.kinopoisk.ru\1&lt;/url&gt;" dest="5+">
				<expression>href=&quot;(/level/17/film/[0-9]+/)&quot;</expression>
			</RegExp>
			<RegExp conditional="fanart" input="$$4" output="&lt;url cache=&quot;tmdb_\2.html&quot; function=&quot;GetTMDBFanartByIMDBUrl&quot;&gt;http://www.imdb.com/find?s=tt&amp;tyear=\1&amp;q=\2&lt;/url&gt;" dest="5+">
				<RegExp input="$$1" output="\9:::\1.\2.\3.\4.\5.\6.\7.\8" dest="4">
					<expression>&lt;span style=&quot;color: #666; font-size: 13px&quot;&gt;([^&lt;\s]+)\s*([^&lt;\s]*)\s*([^&lt;\s]*)\s*([^&lt;\s]*)\s*([^&lt;\s]*)\s*([^&lt;\s]*)\s*([^&lt;\s]*)\s*([^&lt;\s]*)&lt;/span&gt;.+&lt;td class=&quot;&quot;&gt;&lt;a href=&quot;/level/10/m_act%5Byear%5D/[0-9]+/&quot;&gt;([0-9]+)&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;</expression>
				</RegExp>
				<expression>([0-9]+):::(.+)</expression>
			</RegExp>
			<RegExp input="$$4" output="&lt;url cache=&quot;tmdb_\2.html&quot; function=&quot;GetIMDBID&quot;&gt;http://www.imdb.com/find?s=tt&amp;tyear=\1&amp;q=\2&lt;/url&gt;" dest="5+">
				<RegExp input="$$1" output="\9:::\1.\2.\3.\4.\5.\6.\7.\8" dest="4">
					<expression>&lt;span style=&quot;color: #666; font-size: 13px&quot;&gt;([^&lt;\s]+)\s*([^&lt;\s]*)\s*([^&lt;\s]*)\s*([^&lt;\s]*)\s*([^&lt;\s]*)\s*([^&lt;\s]*)\s*([^&lt;\s]*)\s*([^&lt;\s]*)&lt;/span&gt;.+&lt;td class=&quot;&quot;&gt;&lt;a href=&quot;/level/10/m_act%5Byear%5D/[0-9]+/&quot;&gt;([0-9]+)&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;</expression>
				</RegExp>
				<expression>([0-9]+):::(.+)</expression>
			</RegExp>
			<expression noclean="1"/>
		</RegExp>
	</GetDetails>
	<GMF dest="10">
		<RegExp input="$$9" output="&lt;details&gt;&lt;fanart&quot;&gt;\1&lt;/fanart&gt;&lt;/details&gt;" dest="10">
			<RegExp input="$$1" output="&lt;url function=&quot;GMFF&gt;http://www.kinopoisk.ru\1&lt;/url&gt;" dest="9">
				<expression repeat="yes" noclean="1">&lt;a href=&quot;(/picture/\d+/)&quot; target=&quot;_blank&quot;&gt;&lt;img hspace=6 src=&apos;/images/new_win.gif&apos;</expression>
			</RegExp>
			<expression noclean="1"/>
		</RegExp>
	</GMF>
	<GMFF clearbuffers="no" dest="5">
		<RegExp input="$$1" output="&lt;thumb&gt;http://www.kinopoisk.ru\1&lt;/thumb&gt;" dest="5">
			<expression noclean="1">&lt;img.+?src=&apos;([^&apos;]*kadr[^&apos;]*)&apos;.+?style=&quot;border:1px solid #777&quot; onLoad=&apos;&apos;&gt;&lt;/a&gt;&lt;/td&gt;</expression>
		</RegExp>
	</GMFF>
	<GMFR dest="10">
		<RegExp input="$$9" output="&lt;details&gt;&lt;fanart&quot;&gt;\1&lt;/fanart&gt;&lt;/details&gt;" dest="10">
			<RegExp input="$$1" output="&lt;url function=&quot;GMFFR&gt;http://www.kinopoisk.ru\1&lt;/url&gt;" dest="9">
				<expression repeat="yes" noclean="1">&lt;img src=&apos;/images/wallpaper/sm_\d+.jpg&apos; width=\d+ height=\d+ style=&apos;border:5px solid #ccc&apos; vspace=5 alt=&quot;[^&quot;]*&quot;&gt;\s+&lt;br&gt;&lt;a href=&quot;(/picture/[^&quot;]+)&quot; class=all&gt;</expression>
			</RegExp>
			<expression noclean="1"/>
		</RegExp>
	</GMFR>
	<GMFFR clearbuffers="no" dest="5">
		<RegExp input="$$1" output="&lt;thumb&gt;http://www.kinopoisk.ru\1&lt;/thumb&gt;" dest="6+">
			<expression noclean="1">&lt;img.+?src=&apos;([^&apos;]*wallpaper[^&apos;]*)&apos;.+?style=&quot;border:1px solid #777&quot; onLoad=&apos;&apos;&gt;&lt;/a&gt;&lt;/td&gt;</expression>
		</RegExp>
	</GMFFR>
	<GMP dest="4">
		<RegExp input="$$8" output="&lt;details&gt;\1&lt;/details&gt;" dest="4+">
			<RegExp input="$$1" output="&lt;thumb preview=&quot;http://www.kinopoisk.ru/images/poster/sm_\1&quot;&gt;http://www.kinopoisk.ru/images/poster/\1&lt;/thumb&gt;" dest="8+">
				<expression repeat="yes" noclean="1">&lt;a href=&quot;/picture/[0-9]+/&quot;&gt;&lt;img  src=&quot;/images/poster/sm_([^&quot;]+)&quot; width</expression>
			</RegExp>
			<expression noclean="1"/>
		</RegExp>
	</GMP>
	<PEOPLE dest="10">
		<RegExp input="$$7" output="&lt;details&gt;\1&lt;/details&gt;" dest="10">
			<RegExp input="$$1" output="\1" dest="8">
				<expression clear="yes" noclean="1">&lt;tr&gt;&lt;td colspan=3&gt;&lt;a name=&quot;actor&quot;&gt;&lt;/td&gt;&lt;/tr&gt;.+?&lt;/table&gt;(.*?)&lt;tr&gt;&lt;td colspan=3&gt;&lt;a name=&quot;producer&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</expression>
			</RegExp>
			<RegExp input="$$8" output="&lt;n&gt;\2&lt;r&gt;\3&lt;p&gt;http://www.kinopoisk.ru/images/actor/\1&lt;e&gt;" dest="9">
				<expression repeat="yes" trim="3">&lt;img src=&quot;/images/(?:sm_actor/([0-9]+.jpg)|no-poster.gif)&quot; alt=.+?&lt;p&gt;&lt;a href=&quot;/level/4/people/\d+/&quot;&gt;([^&lt;]+)&lt;/a&gt;&lt;b&gt;[^&lt;]+?&lt;/b&gt;... ([^&lt;,]+)</expression>
			</RegExp>
			<RegExp input="$$9" output="&lt;actor&gt;&lt;name&gt;\1&lt;/name&gt;&lt;role&gt;\2&lt;/role&gt;&lt;thumb&gt;\3&lt;/thumb&gt;&lt;/actor&gt;" dest="7">
				<expression repeat="yes" trim="3">&lt;n&gt;([^&lt;]+)&lt;r&gt;([^&lt;]+)&lt;p&gt;(?:(http://www.kinopoisk.ru/images/actor/[0-9]+.jpg)&lt;e&gt;|http://www.kinopoisk.ru/images/actor/&lt;e&gt;)</expression>
			</RegExp>
			<RegExp input="$$1" output="\1" dest="8">
				<expression clear="yes" noclean="1">&lt;tr&gt;&lt;td colspan=3&gt;&lt;a name=&quot;director&quot;&gt;&lt;/td&gt;&lt;/tr&gt;.+?&lt;/table&gt;(.*?)&lt;tr&gt;&lt;td colspan=3&gt;&lt;a name=&quot;actor&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</expression>
			</RegExp>
			<RegExp input="$$8" output="&lt;director&gt;\2&lt;/director&gt;" dest="7+">
				<expression repeat="yes" trim="3">&lt;img src=&quot;([^&quot;]+)&quot; alt=.+?&lt;p&gt;&lt;a href=&quot;/level/4/people/\d+/&quot;&gt;([^&lt;]+)&lt;/a&gt;</expression>
			</RegExp>
			<RegExp input="$$1" output="\1" dest="8">
				<expression clear="yes" noclean="1">&lt;tr&gt;&lt;td colspan=3&gt;&lt;a name=&quot;writer&quot;&gt;&lt;/td&gt;&lt;/tr&gt;(.*?)&lt;table</expression>
			</RegExp>
			<RegExp input="$$8" output="&lt;credits&gt;\2&lt;/credits&gt;" dest="7+">
				<expression repeat="yes" trim="3">&lt;img src=&quot;([^&quot;]+)&quot; alt=.+?&lt;p&gt;&lt;a href=&quot;/level/4/people/\d+/&quot;&gt;([^&lt;]+)&lt;/a&gt;</expression>
			</RegExp>
			<RegExp input="$$1" output="\1" dest="8">
				<expression clear="yes" noclean="1">&lt;tr&gt;&lt;td colspan=3&gt;&lt;a name=&quot;producer&quot;&gt;&lt;/td&gt;&lt;/tr&gt;.+?&lt;/table&gt;(.*?)&lt;tr&gt;&lt;td colspan=3&gt;</expression>
			</RegExp>
			<RegExp input="$$8" output="&lt;producer&gt;\2&lt;/producer&gt;" dest="7+">
				<expression repeat="yes" trim="3">&lt;img src=&quot;([^&quot;]+)&quot; alt=.+?&lt;p&gt;&lt;a href=&quot;/level/4/people/\d+/&quot;&gt;([^&lt;]+)&lt;/a&gt;</expression>
			</RegExp>
			<expression noclean="1"/>
		</RegExp>
	</PEOPLE>
	<GetTMDBFanartByIMDBUrl dest="4">
		<RegExp input="$$5" output="&lt;details&gt;\1&lt;/details&gt;" dest="4">
			<RegExp input="$$1" output="&lt;url cache=&quot;tmdb-imdb-\2.html&quot; function=&quot;GetTMDBFanartById&quot;&gt;http://www.imdb.com/title/tt\2/&lt;/url&gt;" dest="5">
				<expression>(com|&quot;)/title/tt([0-9]+)</expression>
			</RegExp>
			<expression noclean="1"/>
		</RegExp>
	</GetTMDBFanartByIMDBUrl>
	<GetIMDBID dest="4">
		<RegExp input="$$5" output="&lt;details&gt;\1&lt;/details&gt;" dest="4">
			<RegExp input="$$1" output="&lt;id&gt;tt\2&lt;/id&gt;" dest="5">
				<expression>(com|&quot;)/title/tt([0-9]+)</expression>
			</RegExp>
			<expression noclean="1"/>
		</RegExp>
	</GetIMDBID>
</scraper>
